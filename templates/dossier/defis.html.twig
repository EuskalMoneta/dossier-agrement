{% extends 'base.html.twig' %}

{% block title %}Défis{% endblock %}

{% block bgColor %} bg-soft-grey {% endblock %}

{% block content %}

    <div class="container">
        <form method="post">
            <div class="row">
                <div class="col-12">
                    <h3 class="h3-25bold mb-0">
                        Dossier d'agrément - {{ dossierAgrement.libelle }}
                    </h3>
                    <h4 class="h4-sousTitre">{{ dossierAgrement.type }}</h4>

                    <div class="row mt-4">
                        <div class="col-6">
                            <div class="sm-card-recap">
                                <div class="d-flex align-items-top">
                                    <div class="ico-card-recap">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path class="blk" fill-rule="evenodd" clip-rule="evenodd" d="M10 0C4.47727 0 0 4.47727 0 10C0 15.5227 4.47727 20 10 20C15.5227 20 20 15.5227 20 10C20 4.47727 15.5227 0 10 0ZM14.3345 8.30909C14.4144 8.21786 14.4751 8.11158 14.5133 7.99652C14.5514 7.88145 14.5661 7.75992 14.5566 7.63908C14.5471 7.51823 14.5135 7.40051 14.4578 7.29284C14.4021 7.18518 14.3254 7.08973 14.2323 7.01213C14.1392 6.93453 14.0315 6.87633 13.9155 6.84097C13.7996 6.8056 13.6777 6.79378 13.5572 6.80621C13.4366 6.81863 13.3197 6.85504 13.2134 6.9133C13.1071 6.97156 13.0135 7.0505 12.9382 7.14545L9.02909 11.8355L7.00636 9.81182C6.83491 9.64622 6.60527 9.55459 6.36691 9.55666C6.12855 9.55873 5.90054 9.65434 5.73198 9.82289C5.56343 9.99145 5.46782 10.2195 5.46575 10.4578C5.46368 10.6962 5.55531 10.9258 5.72091 11.0973L8.44818 13.8245C8.53751 13.9138 8.64445 13.9835 8.7622 14.0291C8.87994 14.0748 9.00591 14.0954 9.13206 14.0897C9.25822 14.084 9.3818 14.052 9.49492 13.9959C9.60804 13.9397 9.70823 13.8606 9.78909 13.7636L14.3345 8.30909Z" fill="#699BF7"/>
                                        </svg>

                                    </div>
                                    <div class="ms-3">
                                        <h3 class="intro-18bold mb-0 "><a href="{{ path('app_dossier_coordonnees', {'id': dossierAgrement.id}) }}" class="linkText"> Coordonnées</a></h3>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-6">
                            <div class="sm-card-recap">
                                <div class="d-flex align-items-top">
                                    <div class="ico-card-recap">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <g clip-path="url(#clip0_29_30)">
                                                <path d="M6.66669 10.4165L9.16669 12.9165L13.3334 7.9165" stroke="#8D8D8D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M10 18.3332C14.6024 18.3332 18.3334 14.6022 18.3334 9.99984C18.3334 5.39746 14.6024 1.6665 10 1.6665C5.39765 1.6665 1.66669 5.39746 1.66669 9.99984C1.66669 14.6022 5.39765 18.3332 10 18.3332Z" stroke="#8D8D8D" stroke-width="2"/>
                                            </g>
                                            <defs>
                                                <clipPath id="clip0_29_30">
                                                    <rect width="20" height="20" fill="white"/>
                                                </clipPath>
                                            </defs>
                                        </svg>

                                    </div>
                                    <div class="ms-3">
                                        <h3 class="intro-18bold mb-0 grey-color">Défis</h3>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-6 mt-3">
                            <div class="sm-card-recap">
                                <div class="d-flex align-items-top">
                                    <div class="ico-card-recap">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <g clip-path="url(#clip0_29_30)">
                                                <path d="M6.66669 10.4165L9.16669 12.9165L13.3334 7.9165" stroke="#8D8D8D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M10 18.3332C14.6024 18.3332 18.3334 14.6022 18.3334 9.99984C18.3334 5.39746 14.6024 1.6665 10 1.6665C5.39765 1.6665 1.66669 5.39746 1.66669 9.99984C1.66669 14.6022 5.39765 18.3332 10 18.3332Z" stroke="#8D8D8D" stroke-width="2"/>
                                            </g>
                                            <defs>
                                                <clipPath id="clip0_29_30">
                                                    <rect width="20" height="20" fill="white"/>
                                                </clipPath>
                                            </defs>
                                        </svg>

                                    </div>
                                    <div class="ms-3">
                                        <h3 class="intro-18bold mb-0 grey-color"><a href="{{ path('app_dossier_vieDuReseau', {'id': dossierAgrement.id}) }}" class="linkText">Charte/réseau</a></h3>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="row spacer-vertical-column">
                <div class="col-12">
                    <h1 class="H1-header-50 green-color-eusko ">
                        Défis
                    </h1>
                    <p class="mb-5 intro-18reg">Deux défis seront à réaliser, l’un en cours d’année, l’autre l’année suivante.<br/>
                        Le/la chargé(e) de développement est là pour vous accompagner dans leur mise en œuvre.</p>
                    <h3 class="h2-30 green-color-eusko mb-2">
                        1. Relocalisation de l'économie/environement
                    </h3>
                </div>
            </div>

            <div class="row mt-2">
                <div class="col-12">
                    <h4 class="h4-20bold">Vendre ou utiliser au moins trois produits locaux dans son activité</h4>
                </div>

                <div class="col-12" id="defiProduitContainer">
                    {% for defi in dossierAgrement.defis %}
                        {% if defi.type == 'produit' %}
                            <div class="d-flex mt-3 align-items-center">
                                <div class="flex-grow-1">
                                    <input type="text" class="form-control" name="produits[{{ defi.id }}]" value="{{ defi.valeur }}"/>
                                </div>
                                <div class="form-check ms-4 me-2">
                                    <input class="form-check-input" type="radio" name="produits-etat{{ defi.id }}" value="1" {% if defi.etat %} checked {% endif %}>
                                    <label class="form-check-label" for="flexCheckDefault">
                                        Déjà réalisé
                                    </label>
                                </div>
                                <div class="form-check ms-4 me-2" style="">
                                    <input class="form-check-input" type="radio" name="produits-etat{{ defi.id }}" value="0" {% if not defi.etat %} checked {% endif %} >
                                    <label class="form-check-label" for="flexCheckDefault">
                                        A réaliser
                                    </label>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

                <div class="col-12 mt-4">
                    <a class="btn btn-outline-primary" id="defiProduitAjoutBtn"> Ajouter un produit</a>
                </div>
            </div>


            <div class="row mt-5">
                <div class="col-12">
                    <h4 class="h4-sousTitre">Si cela n’est pas possible dans son activité, alors ...</h4>
                    <h4 class="h4-20bold">Faire travailler au moins trois professionnels du réseau Eusko</h4>
                </div>

                <div class="col-12" id="defiProfessionnelContainer">

                    {% for defi in dossierAgrement.defis %}
                        {% if defi.type == 'professionnel' %}
                            <div class="d-flex mt-3 align-items-center">
                                <div class="flex-grow-1">
                                    <div class="d-flex flex-grow-1">
                                        <select name="professionnels[{{ defi.id }}]" class="form-control pro-select form-adresse" style="">
                                            {% if defi.valeur != '' %}
                                                {% set pro = defi.valeur | json_decode  %}
                                                <option value="{{ defi.valeur }}">{{ pro.text }}</option>
                                            {% endif %}
                                        </select>

                                        <input type="button" class="btn btn-outline-dark delSelect" value="X" />


                                    </div>
                                </div>
                                <div class="form-check ms-4 me-2">
                                    <input class="form-check-input" type="radio" name="professionnels-etat{{ defi.id }}" value="1" {% if defi.etat %} checked {% endif %}>
                                    <label class="form-check-label" for="flexCheckDefault">
                                        Déjà réalisé
                                    </label>
                                </div>
                                <div class="form-check ms-4 me-2" style="">
                                    <input class="form-check-input" type="radio" name="professionnels-etat{{ defi.id }}" value="0" {% if not defi.etat %} checked {% endif %} >
                                    <label class="form-check-label" for="flexCheckDefault">
                                        A réaliser
                                    </label>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}



                </div>

                <div class="col-12 mt-4">
                    <a class="btn btn-outline-primary" id="defiProfessionnelAjoutBtn"> Ajouter un professionnel</a>
                </div>
            </div>


            <div class="row mt-5">
                <div class="col-12">
                    <h4 class="h4-sousTitre">Si cela n’est pas possible dans son activité, alors ...</h4>
                    <h4 class="h4-20bold">Réutiliser à titre personnel</h4>
                    {% for defi in dossierAgrement.defis %}
                        {% if defi.type == 'reutiliser' %}
                            <div class="d-flex mt-3 align-items-center">
                                <div class="flex-grow-1">
                                    <div class="mb-3">
                                        <label for="reutiliser" class="form-label">Note obligatoire</label>
                                        <textarea class="form-control" id="reutiliser" name="reutiliser[{{ defi.id }}]" rows="4">{{ defi.valeur }}</textarea>
                                    </div>
                                </div>
                                <div class="form-check ms-4 me-2">
                                    <input class="form-check-input" type="radio" name="reutiliser-etat{{ defi.id }}" value="1" {% if defi.etat %} checked {% endif %}>
                                    <label class="form-check-label" for="flexCheckDefault">
                                        Déjà réalisé
                                    </label>
                                </div>
                                <div class="form-check ms-4 me-2" style="">
                                    <input class="form-check-input" type="radio" name="reutiliser-etat{{ defi.id }}" value="0" {% if not defi.etat %} checked {% endif %} >
                                    <label class="form-check-label" for="flexCheckDefault">
                                        A réaliser
                                    </label>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}

                </div>

            </div>

            <div class="row mt-5">
                <div class="col-12">
                    <h3 class="h2-30 green-color-eusko mb-2">
                        2. Promotion de l'usage public de l'euskara
                    </h3>

                </div>
            </div>


            <div class="row mt-2">
                <div class="col-12">

                    {% for defi in dossierAgrement.defis %}
                        {% if defi.type == 'promotionEuskara' %}
                            <div class="d-flex mt-3 align-items-center">
                                <div class="flex-grow-1">
                                    <h4 class="h4-20bold">Affichage en euskara (signalétique, outils de communication...)</h4>
                                    <div class="form-check ms-4 me-2">
                                        <input class="form-check-input" type="radio" name="promotionEuskara[{{ defi.id }}]" value="En autonomie" {% if defi.valeur == 'En autonomie' %} checked {% endif %}>
                                        <label class="form-check-label form-label">
                                            En autonomie
                                        </label>
                                    </div>
                                    <div class="form-check ms-4 me-2 mt-2">
                                        <input class="form-check-input" type="radio" name="promotionEuskara[{{ defi.id }}]" value="Accompagnement par Bai Euskarari" {% if defi.valeur == 'Accompagnement par Bai Euskarari' %} checked {% endif %}>
                                        <label class="form-check-label form-label">
                                            Accompagnement par Bai Euskarari
                                        </label>
                                    </div>
                                    <div class="form-check ms-4 me-2 mt-2">
                                        <input class="form-check-input" type="radio" name="promotionEuskara[{{ defi.id }}]" value="Accompagnement par Euskal Moneta en partenariat avec l’OPLB" {% if defi.valeur == 'Accompagnement par Euskal Moneta en partenariat avec l’OPLB' %} checked {% endif %}>
                                        <label class="form-check-label form-label">
                                            Accompagnement par Euskal Moneta en partenariat avec l’OPLB
                                        </label>
                                    </div>
                                </div>
                                <div class="d-none">
                                    <div class="form-check ms-4 me-2">
                                        <input class="form-check-input" type="radio" name="promotionEuskara-etat{{ defi.id }}" value="1" {% if defi.etat %} checked {% endif %}>
                                        <label class="form-check-label">
                                            Déjà réalisé
                                        </label>
                                    </div>
                                    <div class="form-check ms-4 me-2" style="">
                                        <input class="form-check-input" type="radio" name="promotionEuskara-etat{{ defi.id }}" value="0" {% if defi.etat is same as false %} checked {% endif %} >
                                        <label class="form-check-label">
                                            A réaliser
                                        </label>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}

                </div>

            </div>

            <div class="row mt-5">
                <div class="col-12">

                    {% for defi in dossierAgrement.defis %}
                        {% if defi.type == 'accueilEuskara' %}
                            <div class="d-flex mt-3 align-items-center">
                                <div class="flex-grow-1">
                                    <input type="hidden" name="accueilEuskara[{{ defi.id }}]" value="" />
                                    <h4 class="h4-20bold">Accueil possible en euskara</h4>
                                </div>
                                <div class="form-check ms-4 me-2">
                                    <input class="form-check-input" type="radio" name="accueilEuskara-etat{{ defi.id }}" value="1" {% if defi.etat %} checked {% endif %}>
                                    <label class="form-check-label">
                                        Déjà réalisé
                                    </label>
                                </div>
                                <div class="form-check ms-4 me-2" style="">
                                    <input class="form-check-input" type="radio" name="accueilEuskara-etat{{ defi.id }}" value="0" {% if defi.etat is same as false %} checked {% endif %} >
                                    <label class="form-check-label">
                                        A réaliser
                                    </label>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}

                </div>

            </div>

            <div class="row mt-5"></div>

            <div class="spacer-end-of-block"></div>

            <input type="submit" class="btn btn-primary" value="Enregistrer">

            <div class="spacer-end-of-block"></div>
        </form>
    </div>



{% endblock %}


    {% block javascript %}

    var cpt =10000000;


    $('#defiProduitAjoutBtn').click(function (){

        //Template du formulaire à générer
        const DefiProduitTemplate = ({ id }) => `
                <div class="d-flex mt-3 align-items-center">
                    <div class="flex-grow-1">
                        <input type="text" class="form-control" name="produits[${id}]" />
                    </div>
                    <div class="form-check ms-4 me-2">
                        <input class="form-check-input" type="radio" name="produits-etat[${id}]" value="1" id="contact-interlocuteur">
                        <label class="form-check-label" for="flexCheckDefault">
                            Déjà réalisé
                        </label>
                    </div>
                    <div class="form-check ms-4 me-2" style="">
                        <input class="form-check-input" type="radio" name="produits-etat[${id}]" value="0" id="contact-interlocuteur">
                        <label class="form-check-label" for="flexCheckDefault">
                            A réaliser
                        </label>
                    </div>
                </div>
        `;
        var templating = [ {id: cpt} ].map(DefiProduitTemplate).join('');
        $('#defiProduitContainer').append(templating);
        cpt++;
    });

    $('#defiProfessionnelAjoutBtn').click(function (){

        //Template du formulaire à générer
        const DefiProduitTemplate = ({ id }) => `
                <div class="d-flex mt-3 align-items-center">
                    <div class="flex-grow-1">
                    <div class="d-flex ">
                    <select name="professionnels[${id}]" class="form-control pro-select form-adresse" style="">
                     </select>
                     <input type="button" class="btn btn-outline-dark delSelect" value="X" />
                     </div>
                    </div>
                    <div class="form-check ms-4 me-2">
                        <input class="form-check-input" type="radio" name="professionnels-etat[${id}]" value="1" >
                        <label class="form-check-label" for="flexCheckDefault">
                            Déjà réalisé
                        </label>
                    </div>
                    <div class="form-check ms-4 me-2" style="">
                        <input class="form-check-input" type="radio" name="professionnels-etat[${id}]" value="0" >
                        <label class="form-check-label" for="flexCheckDefault">
                            A réaliser
                        </label>
                    </div>
                </div>
        `;
        var templating = [ {id: cpt} ].map(DefiProduitTemplate).join('');
        $('#defiProfessionnelContainer').append(templating);
        cpt++;
        initailizeSelect2();
    });

    $('.delSelect').on('click', function (){
        $(this).prev().prev().val(" ").trigger('change');
        $(this).prev().prev().html('<option value =""></option>');
    });

    function initailizeSelect2(){
        //select 2 pour rechercher un pro
        $('.pro-select').select2({
            ajax: {
                url: "{{ path('app_search_pro') }}",
                delay: 250,
                allowClear: true,
                dataType: 'json',
                data: function (term) {
                    var query = {
                        q: term.term
                    }
                    return query;
                },
               processResults: function (data) {
                return {
                    results: $.map(data.results, function (item) {
                    console.log(item);
                    console.log(JSON.stringify(item));
                        return {
                            text: item.text,
                            id: JSON.stringify(item),
                        }
                    })
                };
            }
            },
            minimumInputLength: 3,
            placeholder: 'Saisir une adresse',
        });
    }

    initailizeSelect2();

    {% endblock javascript %}