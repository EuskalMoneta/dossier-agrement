{% extends 'base.html.twig' %}

{% block title %}Mes dossiers{% endblock %}

{% block content %}
    <style>
        .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
        .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
    </style>

    <div class="container mt-5">

        <h1 class="H1-header-40"> Sélection des dossiers pour l'ordre du jour </h1>
        {% for message in app.flashes('warning') %}
            <div class="alert alert-warning">
                {{ message }}
            </div>
        {% endfor %}

        <form method="post" action="{{ path('app_odre_du_jour_generer') }}">
            <div class="mb-4">
                {% if dossiers is empty %}
                    <p class="text-muted">Aucun dossier d'agrément disponible.</p>
                {% else %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th style="width: 50px;">
                                    <input
                                            type="checkbox"
                                            class="form-check-input"
                                            id="selectAll"
                                            onclick="toggleAll(this)"
                                    >
                                </th>
                                <th>Libellé</th>
                                <th>Date d'agrément</th>
                                <th>Chargé de dev</th>
                                <th>Statut chargés dév.</th>
                                <th>Statut agrément</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for dossier in dossiers %}
                                <tr>
                                    <td>
                                        <input
                                                class="form-check-input dossier-checkbox"
                                                type="checkbox"
                                                name="selected_dossiers[]"
                                                value="{{ dossier.id }}"
                                        >
                                    </td>
                                    <td>
                                        {{ dossier.libelle }}
                                    </td>
                                    <td>
                                        {% if dossier.dateAgrement %}
                                            {{ dossier.dateAgrement|date('d/m/Y') }}
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ dossier.utilisateur ?? '-' }}
                                    </td>
                                    <td>
                                        {{ dossier.statutChargesDeveloppement ?? '-' }}
                                    </td>
                                    <td>
                                        {{ dossier.etat ?? '-' }}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endif %}
            </div>

            <div class="d-flex gap-2 mb-2">
                <button type="submit" class="btn btn-primary" {% if dossiers is empty %}disabled{% endif %}>
                    <i class="bi bi-file-earmark-pdf"></i> Générer le compte rendu
                </button>
                <button type="button" class="btn btn-secondary" onclick="toggleAll(this)">
                    Tout sélectionner / Désélectionner
                </button>
            </div>


            <div class="mt-5">
                {{ knp_pagination_render(dossiers) }}
            </div>
        </form>
    </div>

    <script>
        function toggleAll(button) {
            const checkboxes = document.querySelectorAll('input[name="selected_dossiers[]"]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            checkboxes.forEach(cb => cb.checked = !allChecked);
        }
    </script>
{% endblock %}
